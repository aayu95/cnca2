<!DOCTYPE html>
<html>
    <head>
        <title>Analyse Twitter Data</title>

        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <link rel="stylesheet" type="text/css" href="css/map.css">
        <link rel="stylesheet" type="text/css" href="css/home.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    </head>
    <body>
        <script>
            $(document).ready(function() {
                "use strict";
                $('ul.navbar-nav > li').click(function(e) {
                    $('ul.navbar-nav > li').removeClass('active');
                    $(this).addClass('active');
                });
                $(".nicebox").hide();
                $("#legend").hide();
                $("#map").hide();
                $("#mapButton").click(function(e) {
                    $("#about").hide();
                    $("#legend").show();
                    $(".nicebox").show();
                    $("#map").show();
                });
                $("#aboutButton").click(function(e) {
                    $("#legend").hide();
                    $(".nicebox").hide();
                    $("#map").hide();
                    $("#about").show();
                });
            });
        </script>
        <script>
            var map;
            var varMin = Number.MAX_VALUE, varMax = -Number.MAX_VALUE;
            //var suburbList = [];

            function initMap() {
                map = new google.maps.Map(document.getElementById('map'), {
                    zoom: 9,
                    center: {
                    lat: -37.8136,
                    lng: 144.9631
                    }
                });

                map.data.addListener('mouseover', mouseEnter);
                map.data.addListener('mouseout', mouseExit);
                var selectBox = document.getElementById('var');

                google.maps.event.addDomListener(selectBox, 'change', function() {
                    clearData();
                    loadData(selectBox.options[selectBox.selectedIndex].value); 
                });
                loadBoundary();
            }

            function loadBoundary() {
                map.data.loadGeoJson('melbourne.geojson', {}, function(feature){
                    // console.log(map.data.getFeatureById(1).getProperty("SA2_NAME16"));
                });
                google.maps.event.addListenerOnce(map.data, 'addfeature', function() {
                        google.maps.event.trigger(document.getElementById('var'), 'change');
                    });
            }

            function loadData(parameter) {
                var xhr = new XMLHttpRequest();
                xhr.open('GET', parameter + '.json');
                xhr.onload = function() {
                    var data = JSON.parse(xhr.responseText);
                    var suburb;
                    var categoryCount;
                    var id;
                    for(var i=0; i<309; i++) {
                        //Replace with name of suburb
                        id = i+1;
                        suburb=data.features[i].properties.sa2_name16;
                        // suburbList.push(suburb[0]);
                        //Replace with property name of data to be plotted
                        if(parameter === 'creative-people') {
                            categoryCount = data.features[i].properties.p_crtve_arts_tot;
                        }
                        if(parameter === 'income'){
                            if (data.features[i].properties.median_aud===null){
                                continue;
                            }
                            categoryCount = data.features[i].properties.mean_aud;
                        }
                        if(categoryCount<varMin) {
                            varMin=categoryCount;
                        }
                        if(categoryCount>varMax) {
                            varMax=categoryCount;
                        }
                        map.data.getFeatureById(id).setProperty('curr_variable', categoryCount);
                    }
                    document.getElementById('var-min').textContent = varMin.toLocaleString();
                    document.getElementById('var-max').textContent = varMax.toLocaleString();
                    map.data.setStyle(styleFeature);
                };
                xhr.send();
            }

            function clearData() {
                varMin = Number.MAX_VALUE;
                varMax = -Number.MAX_VALUE;
                map.data.forEach(function(row) {
                    row.setProperty('curr_variable', undefined);
                });
                document.getElementById('data-box').style.display = 'none';
                document.getElementById('data-caret').style.display = 'none';
            }

            function styleFeature(feature) {
                //CUSTOMISE ACCORDING TO NUMBER OF COLOURS
                var low = [35, 100, 85];
                var high = [35, 100, 5];
                var diff = (feature.getProperty('curr_variable')-varMin) / (varMax - varMin);
                var colour = [];
                for (var i=0; i<3; i++) {
                    colour[i] = (high[i] - low[i]) * diff + low[i];
                }
                // var showRow = true;
                // if (feature.getProperty('census_variable') == null ||
                //     isNaN(feature.getProperty('census_variable'))) {
                // showRow = false;
                // }
                var outlineWeight = 0.5, zIndex = 1;
                if (feature.getProperty('state') === 'hover') {
                    outlineWeight = zIndex = 2;
                }

                return {
                strokeWeight: outlineWeight,
                strokeColor: '#000',
                zIndex: zIndex,
                fillColor: 'hsl(' + colour[0] + ',' + colour[1] + '%,' + colour[2] + '%)',
                fillOpacity: 0.75
                //visible: showRow
                };
            }

            function mouseEnter(event) {
                event.feature.setProperty('state', 'hover');
                var percent = (event.feature.getProperty('curr_variable') - varMin) / (varMax - varMin) * 100;
                document.getElementById('data-label').textContent =
                event.feature.getProperty('SA2_NAME16');
                document.getElementById('data-value').textContent =
                event.feature.getProperty('curr_variable').toLocaleString();
                document.getElementById('data-box').style.display = 'block';
                document.getElementById('data-caret').style.display = 'block';
                document.getElementById('data-caret').style.paddingLeft = percent + '%';
            }

            function mouseExit(event) {
                event.feature.setProperty('state', 'normal');
            }
        </script>
        <nav class="navbar navbar-expand-lg navbar-dark" style="background-color: #4d004d;">
            <a class="navbar-brand" href="#">Dashboard</a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarText" aria-controls="navbarText" aria-expanded="false" aria-label="Toggle navigation">
              <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarText">
              <ul class="navbar-nav mr-auto">

                <li class="nav-item active">
                  <a class="nav-link" href="#" id="aboutButton">About<span class="sr-only">(current)</span></a>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                      Visualisations
                    </a>
                    <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                      <a class="dropdown-item" href="#" id="mapButton">
                          Map Visualisation</a>
                      <a class="dropdown-item" href="#">Bar Graph</a>
                      <a class="dropdown-item" href="#">Scatter Plot</a>
                    </div>
                  </li>
              </ul>
              <span class="navbar-text">
                Team 15
              </span>
            </div>
        </nav>
        <div id="about">
            <h2>Scenario</h2>
            <br>
            <p>
                The idea is to select a broader theme (sleeping late at night) and build a stroy around it. Benefit here might be that because of filtering tweets on time (and not keywords), we might be able to get more volume of tweets, hence more confidence in our conclusions.
            </p>
            <p>
                <strong> Purpose: </strong> Verify various research studies that suggest different reasons and consequences of sleeping late at night. <br>
                Twitter data: Count of all Tweets per suburb that have a timestamp between 12 AM to 3 AM <br>
                Aurin data: Suburb wise numbers
                <ol>
                    <li>
                        <strong>Analysis type: What are the reasons for sleeping late?</strong>
                        <ul>
                            <li>
                                Number of entertainment facilities (restaurants, bars, clubs etc.)
                            </li>
                            <li>
                                Age (young people tend to sleep late?)
                            </li>
                            <li>
                                No. of hours spent on digital devices (Your electronic devices, including laptops, tablets, TVs, and phones, emit something called blue light. According to the National Sleep Foundation, the blue light emitted from your devices can delay the release of melatonin, the sleep hormone. This can prevent you from becoming sleepy. Is this true?)
                            </li>
                            <li>
                                Cultural - People from certain countries sleep late more often? (Histogram of number of tweets vs. language of tweets)
                            </li>
                        </ul>
                    </li>
                    <br>
                    <li>
                       <strong>Analysis type: What are the consequences of sleeping late?</strong>
                        <ul>
                            <li>
                                Percentage of education levels in suburbs (There are studies which suggests that people who stay up late at nights might be smarter?)
                            </li>
                            <li>
                                Percentage of income levels in suburbs
                            </li>
                            <li>
                                Percentage of people with auto-immune disorders (There are studies that late sleep can weaken immune system?)
                            </li>
                            <li>
                                Percentage of people with diseases (Does it increase chances of getting affected by a disease?)
                            </li>
                            <li>
                                Percentage of people with specific occupations (Studies suggests staying up late is linked with creativity? Do people from creating/innovative professions (e.g. artists, writers, cartoonists, novelists, scientists) tend to stay up late at night?)
                            </li>
                            <li>
                                Percentage of people with stress levels (There is a popular belief that early risers have low stress levels?)
                            </li>
                            <li>
                                Coffee/Energy drinks consumption (People who sleep late have an increased coffee intake?)
                            </li>
                            <li>
                                Sentiment analysis (Does it make feel more happy or sad?)
                            </li>
                        </ul>
                    </li>
                </ol>
            </p>
        </div>
        <div id="controls" class="nicebox">
            <div>
                <select id="var">
                    <option value="creative-people">Number of Creative People</option>
                    <option value="income">Mean Income</option>
                </select>
            </div>
            <div id="legend">
                <div id="var-min">min</div>
                <div class="color-key"><span id="data-caret">&#x25c6;</span></div>
                <div id="var-max">max</div>
            </div>
        </div>
        <div id="data-box" class="nicebox">
            <label id="data-label" for="data-value"></label>
            <span id="data-value"></span>
        </div>
    <div id="map"></div>
        <script async defer
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA1ZHe4DN8e7je8A0V55LrYegHTD9P5nPs&callback=initMap">
        </script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js" integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4" crossorigin="anonymous"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/js/bootstrap.min.js" integrity="sha384-h0AbiXch4ZDo7tp9hKZ4TsHbi047NrKGLO3SEJAg45jXxnGIfYzk4Si90RDIqNm1" crossorigin="anonymous"></script>
    </body>
</html>